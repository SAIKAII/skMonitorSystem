<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- <script src="./jquery-3.2.1.min.js"></script> -->
<title>WebSocket Test</title>
</head>
<body>
<script>
var ws;
window.onload=function(){
  // ws=new WebSocket("wss://saikaii.ngrok.xiaomiqiu.cn:443/print");
  wss=new WebSocket("wss://10.13.16.208:443/print");
  wss.onmessage=function(evt){
    // console.log(evt.data);
    var content = document.getElementById('div_msg');
    content.clear;

    var json = eval('(' + evt.data + ')');
    var str = "<table><tr><th>状态</th><th>进程id</th><th>进程父id</th><th>用户id</th><th>物理内存(KB)</th><th>虚拟内存(KB)</th><th>cpu(%)</th><th>内存占比(%)</th><th>命令</th></tr>";
    for(i in json.processinfo){
      str = str + "<tr><td>" + json.processinfo[i].state + "</td><td>" + json.processinfo[i].pid + "</td><td>" + json.processinfo[i].ppid + "</td><td>" + json.processinfo[i].userid + "</td><td>"  + json.processinfo[i].pmem + "</td><td>";
      str = str + json.processinfo[i].vmem + "</td><td>" + json.processinfo[i].cpu + "</td><td>" + json.processinfo[i].mem + "</td><td>" + json.processinfo[i].cmdline + "</td></tr>";
    }
    str += "</table>";
    content.innerHTML = str;
  };
  wss.onopen=function(evt){
    // ws.send("Hello");
  }
}
window.onclose=function(){
  wss.close();
}
function send_request(md)
{
  var xmlhttp;
  if (window.XMLHttpRequest)
  {
    // IE7+, Firefox, Chrome, Opera, Safari 浏览器执行代码
    xmlhttp=new XMLHttpRequest();
  }
  else
  {
    // IE6, IE5 浏览器执行代码
    xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
  }
  xmlhttp.onreadystatechange=function()
  {
  }
  xmlhttp.open("POST","/power_change.action",true);
  xmlhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
  xmlhttp.send("method="+md);
}
</script>
<div id = "div_msg"></div>
<button type="button" onclick="send_request('cpu_first')">CPU优先</button>
<button type="button" onclick="send_request('mem_first')">MEM优先</button>
<button type="button" onclick="send_request('normal')">缺省方式</button>
</body>
<a href="/access_log.txt" target="_blank"><button type="button">获取访问日志</button></a>
<a href="/run_log.txt" target="_blank"><button type="button">获取服务器运行日志</button></a>
</html>
